<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<th:block layout:fragment="css">
    <link rel="stylesheet" th:href="@{/css/item/item.css}">
</th:block>

<div layout:fragment="content">

    <div class="erp-card">

        <div class="card-header">
            <h2>ë¬¼í’ˆ ìƒì„¸ ì¡°íšŒ (Item List)</h2>
        </div>

        <table class="styled-table">
            <thead>
            <tr>
                <th style="width: 100px;">ID</th>
                <th>ë¬¼í’ˆ ì´ë¦„</th>
                <th>íŒë§¤ ê°€ê²©</th>
                <th>ëŒ€ì—¬ ê°€ê²©</th>
                <th>ì¬ê³  ìˆ˜ëŸ‰</th>
                <th style="width: 100px;">ì…ê³ </th>
            </tr>
            </thead>
            <tbody>
            <tr th:if="${vo.isEmpty()}">
                <td colspan="6" style="text-align: center; padding: 30px;">
                    ë“±ë¡ëœ ë¬¼í’ˆì´ ì—†ìŠµë‹ˆë‹¤.
                </td>
            </tr>

            <tr th:each="item : ${vo}">
                <td th:text="${item.itemInfoId}">ITEM_01</td>
                <td th:text="${item.itemName}" style="font-weight: bold; text-align: left; padding-left: 20px;">ë…¸íŠ¸ë¶</td>

                <td class="text-right money"
                    th:text="${#numbers.formatInteger(item.itemPrice, 0, 'COMMA') + 'ì›'}">
                    1,000,000ì›
                </td>
                <td class="text-right money"
                    th:text="${#numbers.formatInteger(item.rentFee, 0, 'COMMA') + 'ì›'}">
                    50,000ì›
                </td>

                <td style="font-weight: bold; color: #3498db;"
                    th:text="${item.totalQty} + 'ê°œ'">
                    10ê°œ
                </td>

                <td>
                    <button type="button" class="btn-small btn-add"
                            th:onclick="openPurchaseModal([[${item.itemInfoId}]], [[${item.itemName}]], [[${item.itemPrice}]], [[${item.icId}]])">
                        ğŸ“¦ êµ¬ë§¤
                    </button>
                </td>
            </tr>
            </tbody>
        </table>

        <div class="bottom-actions" style="display: flex; justify-content: space-between;">

            <button type="button" class="btn-close"
                    th:onclick="|location.href='@{/item/item_category}'|">
                â¬… ëª©ë¡ìœ¼ë¡œ
            </button>

            <button type="button" class="btn-create"
                    th:if="${icId != null}"
                    onclick="openCreateModal()">
                âœ¨ ìƒˆ ë¬¼í’ˆ ë“±ë¡
            </button>
        </div>

    </div> <div id="purchaseModal" class="modal-overlay hidden">
    <div class="modal-content" style="width: 450px;">

        <div class="modal-header">
            <h3>ë¬¼í’ˆ ì¶”ê°€ êµ¬ë§¤</h3>
            <button type="button" class="close-btn" onclick="closePurchaseModal()">&times;</button>
        </div>

        <div class="modal-body">
            <form th:action="@{/item/item_add}" method="post">

                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                <input type="hidden" id="modalItemInfoId" name="itemInfoId">
                <input type="hidden" id="modalIcId" name="icId">

                <div style="margin-bottom: 15px;">
                    <label class="form-label">ë¬¼í’ˆ ì´ë¦„</label>
                    <input type="text" id="displayItemName" class="form-input readonly-input" readonly>
                </div>

                <div style="margin-bottom: 15px;">
                    <label class="form-label">ë‹¨ê°€ (ì›)</label>
                    <input type="text" id="displayItemPrice" class="form-input readonly-input" readonly>
                </div>

                <div style="margin-bottom: 30px;">
                    <label class="form-label">êµ¬ë§¤ ìˆ˜ëŸ‰ (ê°œ)</label>
                    <input type="number" name="qty" class="form-input highlight-input"
                           placeholder="ìˆ˜ëŸ‰ ì…ë ¥" required min="1">
                </div>

                <div class="modal-footer-actions">
                    <button type="button" class="btn-close" onclick="closePurchaseModal()">ì·¨ì†Œ</button>
                    <button type="submit" class="btn-add-confirm">êµ¬ë§¤ í™•ì •</button>
                </div>
            </form>
        </div>
    </div>
</div>

    <div id="createModal" class="modal-overlay hidden">
        <div class="modal-content" style="width: 500px;">

            <div class="modal-header">
                <h3>ì‹ ê·œ ë¬¼í’ˆ ë“±ë¡</h3>
                <button type="button" class="close-btn" onclick="closeCreateModal()">&times;</button>
            </div>

            <div class="modal-body">
                <form th:action="@{/item/created_item}" method="post">

                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <input type="hidden" name="icId" th:value="${icId}">

                    <div style="margin-bottom: 15px;">
                        <label class="form-label">ë¬¼í’ˆ ì´ë¦„</label>
                        <input type="text" name="itemName" class="form-input"
                               placeholder="ì˜ˆ: ê²Œì´ë° ë…¸íŠ¸ë¶" required>
                    </div>

                    <div class="form-row" style="display: flex; gap: 15px;">
                        <div style="flex: 1; margin-bottom: 15px;">
                            <label class="form-label">íŒë§¤ ê°€ê²© (ì›)</label>
                            <input type="number" name="itemPrice" class="form-input"
                                   placeholder="ì˜ˆ: 1500000" required min="0">
                        </div>
                        <div style="flex: 1; margin-bottom: 15px;">
                            <label class="form-label">ëŒ€ì—¬ ê°€ê²© (ì›)</label>
                            <input type="number" name="rentFee" class="form-input"
                                   placeholder="ì˜ˆ: 50000" required min="0">
                        </div>
                    </div>

                    <div class="modal-footer-actions">
                        <button type="button" class="btn-close" onclick="closeCreateModal()">ì·¨ì†Œ</button>
                        <button type="submit" class="btn-create-confirm">ì•„ì´í…œ ë“±ë¡</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

</div>

<th:block layout:fragment="script">
    <script>
        // --- 1. êµ¬ë§¤(ì¬ê³  ì¶”ê°€) ëª¨ë‹¬ ë¡œì§ ---
        function openPurchaseModal(itemInfoId, itemName, itemPrice, icId) {
            document.getElementById('purchaseModal').classList.remove('hidden');

            // ë°ì´í„° ì£¼ì…
            document.getElementById('modalItemInfoId').value = itemInfoId;
            document.getElementById('modalIcId').value = icId;
            document.getElementById('displayItemName').value = itemName;
            // ê°€ê²©ì— ì½¤ë§ˆ ì°ì–´ì„œ ë³´ì—¬ì£¼ê¸°
            document.getElementById('displayItemPrice').value = new Intl.NumberFormat().format(itemPrice) + "ì›";
        }

        function closePurchaseModal() {
            document.getElementById('purchaseModal').classList.add('hidden');
            document.querySelector('#purchaseModal input[name="qty"]').value = ''; // ìˆ˜ëŸ‰ ì´ˆê¸°í™”
        }

        // --- 2. ì‹ ê·œ ë“±ë¡ ëª¨ë‹¬ ë¡œì§ ---
        function openCreateModal() {
            document.getElementById('createModal').classList.remove('hidden');
        }

        function closeCreateModal() {
            document.getElementById('createModal').classList.add('hidden');
            // ì…ë ¥ì°½ ì´ˆê¸°í™”
            const inputs = document.querySelectorAll('#createModal input:not([type="hidden"])');
            inputs.forEach(input => input.value = '');
        }

        // --- ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸° ---
        window.onclick = function(event) {
            const pModal = document.getElementById('purchaseModal');
            const cModal = document.getElementById('createModal');
            if (event.target === pModal) closePurchaseModal();
            if (event.target === cModal) closeCreateModal();
        }
    </script>
</th:block>
</html>