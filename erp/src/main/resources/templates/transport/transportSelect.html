<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<th:block layout:fragment="css">
    <link rel="stylesheet" th:href="@{/css/fm/transport.css}">
</th:block>

<div layout:fragment="content">

    <div class="erp-card">
        <div class="card-header">
            <h2>ì°¨ëŸ‰ ê´€ë¦¬ (Transport Management)</h2>
        </div>

        <table class="styled-table">
            <thead>
            <tr>
                <th style="width: 100px;">ì°¨ëŸ‰ ID</th>
                <th>ë³´ìœ  ìˆ˜ëŸ‰</th>
                <th>ë ŒíŠ¸ ë¹„ìš©</th>
                <th>ëŒ€ì—¬ ì¤‘</th>
                <th>ëŒ€ì—¬ ê°€ëŠ¥</th>
                <th style="width: 120px;">ê´€ë¦¬</th>
            </tr>
            </thead>
            <tbody>
            <tr th:if="${vo.isEmpty()}">
                <td colspan="6" style="text-align: center; padding: 30px;">
                    ë“±ë¡ëœ ì°¨ëŸ‰ì´ ì—†ìŠµë‹ˆë‹¤.
                </td>
            </tr>

            <tr th:each="item : ${vo}">
                <td th:text="${item.transportId}">TR_001</td>
                <td th:text="${item.truckNum} + 'ëŒ€'">10</td>
                <td class="text-right money"
                    th:text="${#numbers.formatInteger(item.truckFee, 0, 'COMMA') + 'ì›'}">
                    50,000ì›
                </td>
                <td th:text="${item.rented} + 'ëŒ€'">2</td>
                <td style="font-weight: bold; color: #3498db;"
                    th:text="${(item.truckNum - item.rented)} + 'ëŒ€'">
                    8
                </td>

                <td>
                    <button type="button" class="btn-small btn-add"
                            th:onclick="openStockModal([[${item.transportId}]])">
                        ğŸ“¦ ì…ê³ 
                    </button>
                </td>
            </tr>
            </tbody>
        </table>

        <div class="bottom-actions">
            <button type="button" class="btn-create" onclick="openNewTransportModal()">
                ğŸš› ìƒˆë¡œìš´ ì°¨ëŸ‰ ë“±ë¡
            </button>
        </div>

    </div> <div id="stockModal" class="modal-overlay hidden">
    <div class="modal-content" style="width: 400px;">
        <div class="modal-header">
            <h3>ì°¨ëŸ‰ ì¶”ê°€ ì…ê³ </h3>
            <button type="button" class="close-btn" onclick="closeStockModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form th:action="@{/addTransport}" method="post">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                <input type="hidden" id="modalTransportId" name="transportId" />

                <div style="margin-bottom: 20px;">
                    <label style="display:block; margin-bottom:5px; font-weight:bold; color:#555;">ì„ íƒëœ ì°¨ëŸ‰ ID</label>
                    <input type="text" id="displayId" class="form-input" readonly
                           style="background-color: #f2f2f2; width: 100%; box-sizing: border-box;">
                </div>

                <div style="margin-bottom: 30px;">
                    <label style="display:block; margin-bottom:5px; font-weight:bold; color:#555;">ì¶”ê°€í•  ìˆ˜ëŸ‰ (ëŒ€)</label>
                    <input type="number" name="qty" class="form-input" placeholder="ìˆ˜ëŸ‰ ì…ë ¥" required min="1"
                           style="width: 100%; box-sizing: border-box; font-weight: bold; color: #27ae60;">
                </div>

                <div style="text-align: right; border-top: 1px solid #eee; padding-top: 20px;">
                    <button type="button" class="btn-close" onclick="closeStockModal()" style="margin-right: 10px;">ì·¨ì†Œ</button>
                    <button type="submit" class="btn-create" style="width: auto; display: inline-block;">ì…ê³  í™•ì •</button>
                </div>
            </form>
        </div>
    </div>
</div>

    <div id="newTransportModal" class="modal-overlay hidden">
        <div class="modal-content" style="width: 450px;">
            <div class="modal-header">
                <h3>ì‹ ê·œ ì°¨ëŸ‰ êµ¬ë§¤ ê³„ì•½</h3>
                <button type="button" class="close-btn" onclick="closeNewTransportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form th:action="@{/addNewTransport}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                    <div style="margin-bottom: 20px;">
                        <label style="display:block; margin-bottom:5px; font-weight:bold; color:#555;">ì´ˆê¸° ë„ì… ìˆ˜ëŸ‰ (ëŒ€)</label>
                        <input type="number" name="truckNum" class="form-input"
                               placeholder="ì˜ˆ: 5" required min="1"
                               style="width: 100%; box-sizing: border-box;">
                    </div>

                    <div style="margin-bottom: 30px;">
                        <label style="display:block; margin-bottom:5px; font-weight:bold; color:#555;">ëŒ€ì—¬ ë¹„ìš© (ì›)</label>
                        <input type="number" name="truckFee" class="form-input"
                               placeholder="ì˜ˆ: 50000" required min="0"
                               style="width: 100%; box-sizing: border-box;">
                    </div>

                    <div style="text-align: right; border-top: 1px solid #eee; padding-top: 20px;">
                        <button type="button" class="btn-close" onclick="closeNewTransportModal()" style="margin-right: 10px;">ì·¨ì†Œ</button>
                        <button type="submit" class="btn-create" style="width: auto; display: inline-block;">êµ¬ë§¤ í™•ì •</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

</div>

<th:block layout:fragment="script">
    <script>
        // --- ëª¨ë‹¬ 1: ì¬ê³  ì…ê³  ê´€ë ¨ ---
        function openStockModal(transportId) {
            document.getElementById('stockModal').classList.remove('hidden');
            document.getElementById('modalTransportId').value = transportId;
            document.getElementById('displayId').value = transportId;
        }

        function closeStockModal() {
            document.getElementById('stockModal').classList.add('hidden');
            document.querySelector('#stockModal input[name="qty"]').value = ''; // ì…ë ¥ì°½ ë¹„ìš°ê¸°
        }

        // --- ëª¨ë‹¬ 2: ì‹ ê·œ ë“±ë¡ ê´€ë ¨ ---
        function openNewTransportModal() {
            document.getElementById('newTransportModal').classList.remove('hidden');
        }

        function closeNewTransportModal() {
            document.getElementById('newTransportModal').classList.add('hidden');
            // ì…ë ¥ì°½ ë¹„ìš°ê¸°
            const inputs = document.querySelectorAll('#newTransportModal input:not([type="hidden"])');
            inputs.forEach(input => input.value = '');
        }

        // --- ë°°ê²½ í´ë¦­ ì‹œ ë‹«ê¸° (ì´ë²¤íŠ¸ ìœ„ì„) ---
        window.onclick = function(event) {
            const stockModal = document.getElementById('stockModal');
            const newModal = document.getElementById('newTransportModal');

            if (event.target === stockModal) {
                closeStockModal();
            }
            if (event.target === newModal) {
                closeNewTransportModal();
            }
        }
    </script>
</th:block>
</html>